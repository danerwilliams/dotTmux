# === Settings ===

# Remap prefix from Ctrl+b to Ctrl+Space (more ergonomic)
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

set-option -g mouse on

# Vi mode for copy mode (/ to search, hjkl to move, v to select, y to yank)
setw -g mode-keys vi

# Start window/pane numbering at 1 (0 is far from prefix key)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer (per pane)
set -g history-limit 50000

# Fix vim escape delay
set -sg escape-time 0

# Enable focus events
set -g focus-events on

# Reload config easily
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# === Plugins ===

set-environment -g TMUX_PLUGIN_MANAGER_PATH '~/.tmux/plugins'

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'dracula/tmux'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'       # must be after resurrect

# === Plugin Config ===

# Dracula status bar: CPU, RAM, then continuum save status (far right)
set -g @dracula-plugins 'cpu-usage ram-usage continuum'
set -g @dracula-show-powerline true
set -g @dracula-show-left-icon '#S'
set -g @dracula-cpu-usage-label 'CPU'
set -g @dracula-ram-usage-label 'RAM'
set -g @dracula-ram-usage-colors "pink dark_gray"

# Resurrect: save/restore sessions including pane contents and common processes
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-processes 'yarn node npm npx'

# Continuum: auto-save every 10 min, auto-restore on tmux start
set -g @continuum-restore 'on'
set -g @continuum-save-interval '1'

# Initialize TMUX plugin manager (keep this line at the very bottom)
run -b '~/.tmux/plugins/tpm/tpm'

# Override Dracula's continuum script with custom "Last saved at HH:MM" format
run-shell 'cp ~/.tmux/scripts/continuum.sh ~/.tmux/plugins/tmux/scripts/continuum.sh 2>/dev/null || true'
